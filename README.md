



<img width="956" alt="ìŠ¤í¬ë¦°ìƒ· 2022-12-15 15 13 44" src="https://user-images.githubusercontent.com/106936018/207786299-27e6bf64-fd99-4019-a193-976926f9be00.png">

<br/>

# SeSAC Study Matching

> *ê°œë°œê¸°ê°„: 22.11.08 ~ 22.11.30*

* API ëª…ì„¸ì™€ ë””ìì¸ ë¦¬ì†ŒìŠ¤ë¥¼ ì „ë‹¬ ë°›ì•„ ì‹¤ì œ í˜„ì—… ê°œë°œ í™˜ê²½ì„ ê²½í•¨í•œ í”„ë¡œì íŠ¸ ì…ë‹ˆë‹¤.
* íšŒì› ê°€ì…ê³¼ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•˜ê³ , ë‚´ì •ë³´ë¥¼ í™•ì¸ ë° ìˆ˜ì • í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì£¼ë³€ ìŠ¤í„°ë””ë¥¼ êµ¬í•˜ê³ ìˆëŠ” ì‚¬ëŒë“¤ì„ ì§€ë„ìƒì—ì„œ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì›í•˜ëŠ” ìŠ¤í„°ë”” wishListë¥¼ ì‘ì„±í•˜ê³ , wishListì— í•´ë‹¹í•˜ëŠ” ì‚¬ëŒë“¤ì„ ë¶ˆëŸ¬ ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ìƒëŒ€ë°©ì˜ ì›í•˜ëŠ” ìŠ¤í„°ë””ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆê³ , 1 : 1 ì±„íŒ… ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br/>

# Table Of Contents

* [Tech Stack](https://github.com/haha1haka/Study-Matching#tech-stack)
* [Team Collaboration](https://github.com/haha1haka/Study-Matching#team-collaboration)
* [Simulation](https://github.com/haha1haka/Study-Matching#simulation)
* [Trouble Shooting](https://github.com/haha1haka/Study-Matching#-trouble-shooting)

    



<br/>



## Tech Stack 

* MVVM
* Swift5.7
* UIKit
* RxSwift
* RxCocoa
* RealmDatabase
* URLSession
* FirebaseAuth
* APNs
* Mapkit
* SnapKit
* Confluence
* Swagger
* InSomnia
* Figma




<br/>

## Team Collaboration



> íŒ€ëª…: ë¬¸ì–´ë‹¨(ê°œë°œí•˜ë‹¤ ë¨¸ë¦¬ ë¹ ì ¸ì„œ ë¬¸ì–´ì˜ ë¨¸ë¦¬ì²˜ëŸ¼ ë˜ëŠ”ê²ƒ ì˜ê´‘ìœ¼ë¡œ ìƒê°í•˜ìëŠ”?? ã…ã…)

<img width="763" alt="ìŠ¤í¬ë¦°ìƒ· 2022-12-15 16 19 21" src="https://user-images.githubusercontent.com/106936018/207797401-bc0f1525-1529-47d2-adb8-f45c8c900778.png">

### Team Communication

* ì„œë¹„ìŠ¤ì ìœ¼ë¡œ ê³ ë ¤í•´ì•¼í•  ì§€ì ë“¤ì„ ë…¼ì˜í•˜ê³ , í•´ê²°í•´ ê°”ìŠµë‹ˆë‹¤.

* ë§¤ì¼ ìŠ¤í¬ëŸ¼ì„ ì‘ì„±í•˜ì—¬,ì„œë¡œì˜ ê¸°ìˆ ì„ ê³µìœ í•˜ê³ , ë…¼ì˜ í–ˆë˜ ì ê³¼ ì§„í–‰ ìƒí™©ì„ ì†Œí†µ í•˜ì˜€ìŠµë‹ˆë‹¤.




<img width="587" alt="ìŠ¤í¬ë¦°ìƒ· 2022-12-15 16 19 41" src="https://user-images.githubusercontent.com/106936018/207797465-2492b29c-028a-4cea-95cb-366ac8eddca8.png">



<img width="559" alt="ìŠ¤í¬ë¦°ìƒ· 2022-12-15 16 19 50" src="https://user-images.githubusercontent.com/106936018/207797498-3d662e9c-0b95-4dad-a44c-5426d06a06dc.png">

<img width="565" alt="ìŠ¤í¬ë¦°ìƒ· 2022-12-15 16 19 59" src="https://user-images.githubusercontent.com/106936018/207797521-7880dbb2-623d-4fd3-ba3a-e40a6c695172.png">



<img width="181" alt="ìŠ¤í¬ë¦°ìƒ· 2022-12-15 16 20 12" src="https://user-images.githubusercontent.com/106936018/207797566-5bd3c092-3d57-4e36-a398-65a222ac8e5d.png">



### Figma

<img width="858" alt="ìŠ¤í¬ë¦°ìƒ· 2022-12-17 16 49 23" src="https://user-images.githubusercontent.com/106936018/208231725-996689b6-7f72-4d86-8594-dcf96892b747.png">





<br/>

## Simulation

### 1. SplashViewController & Onboarding

![11ì˜¨ë³´ë”©](https://user-images.githubusercontent.com/106936018/208286582-db48a7e9-1899-4403-8efd-1a8e34bc9327.gif)





* LauchScreenì„ controller ë¡œ ë§Œë“¤ì–´ ë„¤íŠ¸ì›Œí‚¹ ì‹ í˜¸ ì•½í• ì‹œ  ëŒ€ì‘
* NWPathMonitor ë¥¼ ì´ìš©í•œ ì‹¤ì‹œê°„ ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§



### 2. SignUp & SignIn

![2222íšŒì›](https://user-images.githubusercontent.com/106936018/208286586-a042406c-7868-4ec3-af25-447268403e62.gif)





* FirebaseAuth ì „í™”ë²ˆí˜¸ ì¸ì¦ì„ ì´ìš©í•œ ë¡œê·¸ì¸
* ë¡œê·¸ì¸ì‹œ í•´ë‹¹ updateFCMTokenì„ ì„œë²„ì— post. ë©€í‹°ë””ë°”ì´ìŠ¤ ëŒ€ì‘
* ì „í™”ë²ˆí˜¸, ì´ë©”ì¼, ìƒë…„ì›”ì¼ ë“± ìœ íš¨ì„± ê²€ì‚¬ 
* ì´ë¯¸ íšŒì›ê°€ì…ì´ ëœ ìœ ì €, ê¸ˆì§€ëœ ë‹¨ì–´ì˜ ë‹‰ë„¤ì„, í† í°ë§Œë£Œ ë“± ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ case ëŒ€ì‘ 




### 3. MyInfo



![33myinfo](https://user-images.githubusercontent.com/106936018/208286593-70071d1c-1a2d-4f93-815b-f0518584c3a6.gif)



* CompositionalLayoutì„ ì´ìš©í•œ Expandable Cell UI êµ¬ì„±
* ì €ì¥ë²„íŠ¼ í´ë¦­ì‹œ ì •ë³´ update 
* íšŒì› íƒˆí‡´ì§„í–‰ ë° í™”ë©´ ë¶„ê¸°ì²˜ë¦¬



### 4. Map & ì£¼ë³€ ìœ ì € ë§¤ì¹­



![44map](https://user-images.githubusercontent.com/106936018/208286597-e4c3250f-6bd6-4ed2-bddb-30688e480931.gif)

* CLLocationì„ ì´ìš©í•œ ìœ„ì¹˜ì„œë¹„ìŠ¤ í™•ì¸ ê¶Œí•œìš”ì²­
* ì‚¬ìš©ì ìœ„ì¹˜ ë³€ê²½ì‹œë§ˆë‹¤ useríƒìƒ‰, ì„±ë³„êµ¬ë¶„, GPSë²„íŠ¼ì„ í†µí•œ ë³¸ì¸ ìœ„ì¹˜ í™•ì¸
* ì‚¬ìš©ìì˜ í˜„ì¬ìƒíƒœ(íƒìƒ‰, ë§¤ì¹­ëŒ€ê¸°, ë§¤ì¹­)ì— ë”°ë¼ UIì²˜ë¦¬
* Mapkitì„ ì´ìš©í•˜ì—¬, ì£¼ë³€ ì‚¬ìš©ì íƒìƒ‰ ë° CustomAnnotation í‘œì‹œ 
* ì¶”ì²œ ìŠ¤í„°ë”” ìƒë‹¨ ë°°ì¹˜, ì¤‘ë³µ ìŠ¤í„°ë”” ì œê±° ë“± ëŒ€ì‘
* 5ì´ˆë§ˆë‹¤ ì„œë²„ í˜¸ì¶œì„ í†µí•´ ì‚¬ìš©ì(ë³¸ì¸)ìƒíƒœ í™•ì¸í•˜ì—¬, ë§¤ì¹­í™•ì •ë˜ë©´ ìë™ìœ¼ë¡œ ì±„íŒ…í™”ë©´ ì§„ì…



### 5. Chat

![chat](https://user-images.githubusercontent.com/106936018/208351792-6e73ddf5-08c0-4696-9226-b3bd7bc81854.gif)

* WebSocket ì„ ì´ìš©í•œ 1 : 1 ì±„íŒ… êµ¬í˜„
* ì§€ë‚œë‚´ì—­ì˜ ì±„íŒ…ë“¤ì„ realmDBìƒì— ì €ì¥, ì±„íŒ…ë°©ì— ì…ì¥ì‹œ, ì§€ë‚œ ì±„íŒ… ë‚´ì—­ë“¤ fetch
* ì†Œì¼“ì„ ì—°ê²°í•˜ê³  í•´ì œ í•´ì¤˜ì•¼í•˜ëŠ” ì‹œì  ëŒ€ì‘



<br/>







## ğŸ’¥ Trouble Shooting



### application/x-www.form-urlencoded

* ContentTypeì´ **application/x-www.form-urlencoded** ì¼ê²½ìš°
    * ì„œë²„ì— post ì‹œ encoding ì„ í•„ìˆ˜ë¡œ ì§„í–‰ í•´ì•¼í•˜ëŠ”ë° ìƒëµ
    * key=value&key=&value&key=&value..í˜•íƒœë¡œ ë°ì´í„° ì „ì†¡
    * Router body parameter êµ¬ì¡°ê°œì„ 

```swift
case .queue(let lat, let long, let studylist):
    var parameters = ["lat": "\(lat)", "long": "\(long)"]
                        .compactMap{ "\($0)=\($1)" }
                        .joined(separator: "&")
            
    studylist.forEach { parameters += "&studylist=\($0)" }
            
    return parameters
```

* Alomofire, Moyaë“± ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œëŠ” Arrayë¥¼ encode í• ë•Œ `.noBracket`ìœ¼ë¡œ Encoding í›„ì— í†µì‹  í•˜ë©´ ì‰½ê²ŒëŒ

    

#### Content-Typeì˜ ì´í•´

> * api ì—°ë™ì‹œ Message Body ì— ë“¤ì–´ê°€ëŠ” íƒ€ì…ì„ HTTP Header ì— ëª…ì‹œí•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” í•„ë“œ
> * Message Body ì˜ type ì •ë³´ë¥¼ ë‚˜íƒ€ëƒ…
> * application/json ê³¼ application/x-www.form-urlencoded ë‘ì¢…ë¥˜ ì¡´ì¬



<br/>



### RxRelam ì„ ì´ìš©í•œ ì±„íŒ… êµ¬í˜„ 

* ëª¨ë“  ì±„íŒ…Log realm ì— ì €ì¥í•´ì„œ, log(Data)ê°€ ë³€ê²½ë ì‹œ UIêµ¬ì„± í• ë ¤ê³ í•¨
* ì±„íŒ…ì´ ì•ˆ ì´ë£¨ì–´ì§€ê³  ìˆì„ì‹œ, ìƒëŒ€ë°©ì˜ chatting ë‚´ì—­ì€ realm ì— ì¡´ì¬ í•˜ì§€ ì•ŠëŠ” ë¬¸ì œì ìœ¼ë¡œ,
* ì´ì „ ë‚´ì—­ì˜ chatting ì„ ë¶ˆëŸ¬ì˜¬ì‹œ sync ì•ˆë§ìŒ
* ìƒëŒ€ì˜ ë§ˆì§€ë§‰ chatting ì‹œê°ìœ¼ë¡œ   `{baseURL}/v1/chat/{from}?lastchatDate={lastchatDate}` api í˜¸ì¶œë¡œ í•´ê²°

#### ê¸°ì¡´ì½”ë“œ

```swift
Observable.changeset(from: viewModel.chatDataBase) 
    .bind(onNext: { array, changes in
     var snapshot = self.dataSource.snapshot()
    snapshot.appendSections([0])
    snapshot.appendItems(array.toArray(), toSection: 0)
    snashot.reconfigureItems(array.toArray())
    self.dataSource.apply(snapshot)
})
```

#### ê°œì„ 

```swift
viewModel.payloadChat // payloadChat: ìƒëŒ€ ë§ˆì§€ë§‰ chat data ê¸°ì¤€ìœ¼ë¡œ ì´ì „ì±„íŒ… ë‚´ì—­ api í˜¸ì¶œ í›„ ë„˜ì–´ì˜¨ chat
    .bind(onNext: { payloadChat in
    snapshot.appendItems(self.viewModel.chatDataBase.toArray(),toSection: 0)
    if !snapshot.sectionIdentifiers.isEmpty {
    snapshot.appendItems(payloadChat,toSection: 0)
    }
    self.dataSource.apply(snapshot)
})
.disposed(by: disposeBag)
```

<br/>

### ë©€í‹°ë””ë°”ì´ìŠ¤ ëŒ€ì‘ 

* íƒ€ì¸ì˜ Deviceì— ë‚´ ì•„ì´ë””ë¡œ ë¡œê·¸ì¸ì„ ì§„í–‰ í–ˆì„ì‹œ, íƒ€ì¸ì˜ `FCM(Firebase Cloud Message)` ì„ ë‚´ê°€ ì“°ê²Œ ë˜ëŠ”ê²ƒì„ ë°©ì§€
* `{baseURL}/v1/user/update_fcm_token` api ë¥¼ **ë¡œê·¸ì¸ì‹œ ì„œë²„ë¡œ ë³´ë‚´** ë³¸ì¸ê³¼ ì„œë²„ FCMToken syncë¥¼ ë§ì¶°ì£¼ê¸°





<br/>

### dataSource(cell)ì˜ ItemType êµ¬ë¶„í•˜ê¸°

* 1ê°œì˜ collectionView ê°ê° ë‹¤ë¥¸ cell ì— ê°ê° ë‹¤ë¥¸ ItemType ì„ êµ¬ë¶„ì§€ì–´ì•¼ í•˜ëŠ” ë¬¸ì œ
* í•´ë‹¹ ê° cellì˜  ItemTypeì„ enum case ì—°ê´€ê°’ìœ¼ë¡œ ë‹´ì•„ë†“ê¸°

```swift
enum Item: Hashable {
    case main(Main)
    case sub(Sub)
}
```

* ê°ê° êµ¬ë¶„ëœ Type ìœ¼ë¡œ êµ¬ì„±ëœ Item ì„ ItemTypedìœ¼ë¡œ diffableDatasource êµ¬ì„±

```swift
class ProfileDataSource: UICollectionViewDiffableDataSource<Int, Item> {
    convenience init(collectionView:       UICollectionView,
                     mainCellRegistration: ProfileMainCellRegistration,
                     subCellRegistration:  ProfileSubCellRegistration)
    {
        self.init(collectionView: collectionView) {
            collectionView, indexPath, itemIdentifier in
            switch itemIdentifier {
            case .main(let main):
                let cell = collectionView.dequeueConfiguredReusableCell(
                    using: mainCellRegistration,
                    for: indexPath,
                    item: main)
                return cell
            case .sub(let sub):
                let cell = collectionView.dequeueConfiguredReusableCell(
                    using: subCellRegistration,
                    for: indexPath,
                    item: sub)
                return cell
            }
        }
}
```



<br/>



### ExpandableCell

* cell í´ë¦­ì‹œ expandable í•˜ê²Œ êµ¬í˜„ í•´ì•¼ í•˜ëŠ” ë¬¸ì œ 
* ì¹´ë“œë·°ê°€ ì ‘í˜€ ìˆì„ë•Œì™€, ì—´ë ¤ ìˆì„ë•Œ constrains ë¥¼ ë‘¬ì„œ
* cellì´ isSelected ë ì‹œ updateAppearance()í•´ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°

```swift
func updateAppearance() {
    closedConstraint?.isActive = !isSelected
    openConstraint?.isActive = isSelected
        
    UIView.animate(withDuration: 0.3) {
        let upsideDown = CGAffineTransform(rotationAngle: .pi * 0.999 )
        self.disclosureView.transform = self.isSelected ? upsideDown :.identity
    }
}
```

* ì—¬ê¸°ì„œ,  UIë¥¼ ì—…ë°ì´íŠ¸ ì‹œì¼œì£¼ê¸° ìœ„í•´ datasource ë¥¼ refresh í•´ì£¼ëŠ” ì½”ë“œë¥¼ **shouldSelectItemAt** (Delegateë§¤ì„œë“œ)ì— êµ¬í˜„ í•´ì„œ í•´ê²°

```swift
    func collectionView(
        _ collectionView: UICollectionView,
        shouldSelectItemAt indexPath: IndexPath
    ) -> Bool {

        if collectionView.indexPathsForSelectedItems?.contains(indexPath) ?? false {
            collectionView.deselectItem(at: indexPath, animated: true)
        } else {
            collectionView.selectItem(at: indexPath, animated: true, scrollPosition: [])
        }
        
        dataSource.refresh()
        
        return false
    }
```



#### shouldSelectItemAtì´í•´

> cell ì„ ì„ íƒëœ ìƒíƒœë¡œ í• ê±´ì§€ ì•ˆí• ê±´ì§€ true false ë¡œ ì²˜ë¦¬ ê°€ëŠ¥





















































